# Worksite ‚Äì AI Coding Rules (STRICT & COMPLETE)

This file defines NON-NEGOTIABLE rules for AI-generated code.
It is the primary authority for Cursor.

If any rule cannot be followed:
‚Üí STOP
‚Üí Explain why
‚Üí Propose safe alternatives
‚Üí Do NOT guess or silently violate rules

This file works together with:
- agents.md ‚Üí tools, @agents, patterns
- docs/*.md ‚Üí factual, auto-generated docs

---

## 1. Project Overview

Worksite is a full-stack Construction Project Management System (PMS)
built as a Turborepo monorepo.

### Applications
- apps/mobile ‚Üí React Native + Expo + NativeWind
- apps/web ‚Üí React + Vite + Tailwind CSS + shadcn/ui
- apps/api ‚Üí Fastify + Prisma

### Shared Packages
- packages/ui ‚Üí shared design tokens ONLY (no components)
- packages/types ‚Üí shared TypeScript types

---

## 2. Global Coding Rules (ALL APPS)

### Language & Style
1. TypeScript ONLY (strict mode)
2. Functional components + hooks ONLY
3. Prefer composition over inheritance
4. Use `const` by default (no `var`, minimal `let`)
5. Use `async/await` (no `.then`)
6. Explicit error handling (`try/catch`)
7. ‚ùå No `any` types (use proper types or `unknown`)
8. ‚ùå No side effects in render
9. Prefer pure, testable functions

---

## 3. File Size & Modularity (CRITICAL)

- Soft limit: 150 lines per file
- Hard rule: no monolithic screens or components
- If file grows:
  - extract hooks
  - extract UI components
  - extract utilities

UI logic, data logic, and layout MUST be separated.

---

## 4. Architecture Rules (ABSOLUTE)

### Separation of Concerns
- UI components ‚Üí presentational ONLY
- Business logic ‚Üí hooks or services
- API calls ‚Üí React Query hooks ONLY
- Screens ‚Üí composition layer

‚ùå NO API calls inside JSX  
‚ùå NO business logic inside render  
‚ùå NO data mutation inside components  

---

## 5. Import Order (MANDATORY)

```ts
// 1. React / Expo
import { useEffect } from 'react';

// 2. External libraries
import { useQuery } from '@tanstack/react-query';

// 3. Workspace packages
import type { Project } from '@worksite/types';

// 4. App absolute imports
import { Button } from '@/components/ui/button';

// 5. Relative imports
import { useProjects } from '../hooks/useProjects';

// 6. Types (if not already imported)
import type { Props } from './types';
```

---

## 6. Web App Rules (apps/web) üö®

### UI System (NON-NEGOTIABLE)

1. ALWAYS use shadcn/ui components if available
2. Customize using Tailwind CSS classes ONLY
3. ‚ùå NO inline styles (`style={{}}`)
4. ‚ùå NO CSS-in-JS
5. ‚ùå NO custom UI components if a shadcn equivalent exists
6. Extend or wrap shadcn components when necessary

Example:
```tsx
<Button className="h-10 rounded-lg px-4 text-sm">
  Save
</Button>
```

### Styling Rules
- Tailwind ONLY
- Use semantic spacing (`gap-2`, `gap-4`, `p-4`)
- Use consistent typography utilities
- Follow existing visual language

### Layout Discipline
Prefer shadcn primitives:
- Card
- Table
- Tabs
- Dialog
- Sheet
- DropdownMenu

Dashboards must remain dense but readable.

---

## 7. Mobile App Rules (apps/mobile) üì±

### UI & Styling
- React Native + Expo Router
- NativeWind ONLY for styling
- ‚ùå No inline styles
- ‚ùå No StyleSheet.create unless unavoidable
- UI components must be reusable across screens

### Navigation
- Follow Expo Router conventions
- ‚ùå No custom navigation stacks unless required

---

## 8. Data & State Management

### Server State
- TanStack Query ONLY
- Queries live in /data or /hooks
- Every screen MUST handle:
  - loading state
  - empty state
  - error state

### Client / UI State
- Local component state ONLY
- ‚ùå No global state unless explicitly approved

---

## 9. Feature Development Workflow (MANDATORY)

### Before Writing Code
AI MUST:
1. Identify the target app (web, mobile, api)
2. List files to be created or modified
3. Explain responsibility of each file
4. Reference existing files as patterns

### Implementation Order
1. Types
2. API / data hooks
3. Reusable UI components
4. Screen container
5. Loading / empty / error states

---

## 10. UI Reference Rule (STRICT)

When UI design references exist (screenshots, images, existing screens, or code references):

1. ALWAYS prefer shadcn/ui components first (web)
2. Match layout and spacing using Tailwind ONLY
3. ‚ùå No inline styles at any cost
4. Custom styles allowed ONLY when shadcn cannot support the requirement
5. Visual consistency is more important than exact pixel matching

---

## 11. Self-Review Step (REQUIRED)

After generating code, AI MUST include a short self-review covering:
- Any duplicated logic
- Any files exceeding size limits
- Any deviation from these rules
- Suggested refactors (if needed)

---

## 12. Backend Rules (apps/api)

- Fastify plugins for routes
- Prisma for database access ONLY
- ‚ùå No raw SQL unless explicitly approved
- Zod for all validation
- Services ‚Üí business logic
- Repositories ‚Üí database access

---

## 13. Security Rules (ABSOLUTE)

‚ùå Never commit `.env`  
‚ùå Never hardcode secrets  
‚ùå Never bypass validation  

‚úÖ Always validate inputs  
‚úÖ Always use Prisma  
‚úÖ Respect organization and project boundaries  

---

## 14. AI Tooling & Context

### Available @agents
- @frontend ‚Üí Web UI (Tailwind + shadcn)
- @mobile ‚Üí React Native + Expo
- @backend ‚Üí Fastify APIs
- @database ‚Üí Prisma / PostgreSQL
- @reviewer ‚Üí Code review

### Adding a New Tool or Library
1. Install dependency
2. Update agents.md
3. Acknowledge update before using it

---

## FINAL RULE (MOST IMPORTANT)

Consistency > Cleverness

When unsure:
- Follow existing patterns
- Reference real files
- Keep solutions boring, explicit, and maintainable
